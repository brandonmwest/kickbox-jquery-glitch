$(function() {
  //Oh hey! Let's add an email collection widget.
  //In this example, we're going to add one form via a button push
  
  //when <button id="button"> is clicked, this code will run
  $('#create-form').click(function(event){
    event.preventDefault();
    $('#intro').remove();  //remove the intro paragraph
    
    //grab all elements that are widgets
    var widgets = $('.kickbox-form');

    widgets.each(function(){
      //turn each widget element into a form!
      //we have to provide an authenticate function
      
      //in this example, we're providing a callback called `authenticate`, defined below
      $(this).kickboxForm(
        { authenticate: authenticate, onAuthenticateSuccess: hideForm }
      );   
    });
  });
  
  //the callback we must supply to the widget to interact with our server-side code
  //must take 3 parameters: email, fingerprint, and app_code
  //must return a jQuery POST request object
  var authenticate = function(email, fingerprint, kickbox_app_code){
    return $.post( "/authenticate", { //return a request object pointing to server-side /authenticate endpoint (see server.js)
      email: email, // the email address from the form
      fingerprint: fingerprint, // the fingerprint generated by calling Kickbox.fingerprint()
      kickbox_app_code: kickbox_app_code, // your Recipient Authentication app code from Kickbox
      dataType: "json" //the server-side endpoint must return a JSON object with a track_token key
    });
  }
  
  var hideForm = function(){ $('form').hide() };
});